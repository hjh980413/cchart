{% extends 'base/base.html' %}
{% block title %}MACD 나도해보자{% endblock %}
{% block extendjs %}<script type="text/javascript" src="/static/js/highstock.js"></script>{% endblock %}
{% block content %}
    <div>
        <form method="GET" action="/edu/macd">
            <label>종목코드 : <input type="text" name="code" value="{{ CODE }}"></label>
            <label>sdate : <input type="date" name="sdate" value="{{ SDATE }}"></label>
            <label>edate : <input type="date" name="edate" value="{{ EDATE }}"></label>
            <input type="submit">
        </form>
    </div>
    <div id="chart_container" style="min-width: 310px; height: 800px; margin: 0 auto"></div>
    <script type="text/javascript">
        $.getJSON('/edu/macd.data?code={{ CODE }}&sdate={{ SDATE }}&edate={{ EDATE }}', function (data) {
            //[0] = date
            //[1] = open
            //[2] = high
            //[3] = low
            //[4] = close
            //[5] = adj close
            //[6] = singal(9일)
            //[7] = 단기 이동 평균선(12일)
            //[8] = 장기 이동 평균선(26일)
            //[9] = MACD
            
            var ohlc = []; //캔들챠트
            var m9data = []; // signal
            var m12data = []; // 5일 이동평균선
            var m26data = []; // 20일 이동평균선
            var macd = []; // macd
            
            var i = 0;
            var dataLength = data[0].length;
            
            for (i; i < dataLength; i += 1) {
                ohlc.push([
                    data[0][i][0], // the date
                    data[0][i][1], // open
                    data[0][i][2], // high
                    data[0][i][3], // low
                    data[0][i][4], // close
                ]);

                m9data.push([
                    data[0][i][0], // the date
                    data[0][i][6] // the 12days moving average
                ]);
                
                m12data.push([
                    data[0][i][0], // the date
                    data[0][i][7] // the 12days moving average
                ]);

                m26data.push([
                    data[0][i][0], // the date
                    data[0][i][8] // the 26days moving average
                ]);
                
                macd.push([
                    data[0][i][0], // the date
                    data[0][i][9] // macd
                ]);
            }
            //var goldencrossdata = data[1];
            //var deadcrossdata = data[2];
            //var buypositiondata = data[3];

            Highcharts.stockChart('chart_container', {
                chart: {
                    animation: Highcharts.svg,
                },
                rangeSelector: {
                    selected: 1
                },
                // 마우스 온 이라고 했을때, 툴팁이 분리되서 표출여부
                tooltip: {
                    split: false
                },

                title: {
                    text: '{{ CODE }}'
                },
                yAxis: [
                    {
                        labels: {align: 'right',x: -3},
                        title: {text: 'chart 1'},
                        height: '50%',
                        lineWidth: 2
                    },
                    {
                        labels: {align: 'right',x: -3},
                        title: {text: 'chart1'},
                        top: '50%',
                        height: '25%',
                        offset: 0,
                        lineWidth: 2,
                        
                        plotLines: [{
                            value: 0,
                            color: 'green',
                            dashStyle: 'shortdash',
                            width: 2,
                            label: {
                                text: '0'
                            }
                        }],
                        
                    },
                    {
                        labels: {align: 'right',x: -3},
                        title: {text: 'chart 2'},
                        top: '75%',
                        height: '25%',
                        offset: 0,
                        lineWidth: 2
                    },
                ],
                series: [
                    // 캔들스틱
                    {
                        type: 'candlestick',
                        id:'candlestick',
                        name: 'item',
                        data: ohlc,
                        yAxis: 0,
                    },
                    //{name: 'M9',id: 'M9',type: 'spline',data: m9data,color:'#FF0000'}, // 단기 이평선
                    {name: 'M12',id: 'M12',type: 'spline',data: m12data,color:'#1DDB16'}, // 단기 이평선
                    {name: 'M26',id: 'M26',type: 'spline',data: m26data,color:'#0100FF'}, // 장기 이평선
                    
                    // macd
                    {
                        name: 'macd',
                        id: 'macd',
                        type: 'line',
                        data: macd,
                        yAxis: 1,
                    },
                ]
            });
        });
    </script>
{% endblock %}